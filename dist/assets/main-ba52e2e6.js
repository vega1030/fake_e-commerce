import{getDatabase as f,push as Z,ref as w,set as H,get as q}from"https://www.gstatic.com/firebasejs/9.2.0/firebase-database.js";import{initializeApp as Q}from"https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js";import{getAuth as X,setPersistence as tt,browserSessionPersistence as et,GoogleAuthProvider as st,signInWithPopup as rt,signOut as nt}from"https://www.gstatic.com/firebasejs/9.2.0/firebase-auth.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const d={FAVORITES:"favorites",CART:"cart"},g={UID:"uid",TOKEN:"token",PROFILE_PHOTO:"profile_photo",USER_NAME:"user_name"},R={ALL_PRODUCTS:"https://fakestoreapi.com/products",GET_CATEGORIES:"https://fakestoreapi.com/products/categories",GET_PRODUCTS_BY_CATEGORY:o=>`https://fakestoreapi.com/products/category/${o}`,GET_PRODUCT:o=>`https://fakestoreapi.com/products/${Number(o)}`},at=async()=>{try{return await(await fetch(R.ALL_PRODUCTS)).json()}catch(o){console.log(o)}},ot=async()=>{try{return await(await fetch(R.GET_CATEGORIES)).json()}catch(o){console.log(o)}},it=async o=>{try{return await(await fetch(R.GET_PRODUCTS_BY_CATEGORY(o))).json()}catch(t){console.log(t)}},S=async o=>{try{if(o=="")console.log("error");else return await(await fetch(R.GET_PRODUCT(o))).json()}catch(t){console.log(t)}},u=o=>{const t=document.querySelector(".overlay");t!==null&&((o?t.style.display="none":t.style.display="flex")==="flex"?document.body.style.overflow="hidden":document.body.style.overflow="auto")};class m{setItem(t,e){const s=JSON.stringify(e);typeof localStorage<"u"&&localStorage.setItem(t,s)}getItem(t){return typeof localStorage<"u"?JSON.parse(localStorage.getItem(t))||[]:[]}removeItem(t){localStorage.removeItem(t)}sessionStorageUid(t,e){sessionStorage.setItem(t,e)}getSessionStorageUid(t){return sessionStorage.getItem(t)}sessionStorageToken(t,e){sessionStorage.setItem(t,e)}getSessionStorageToken(t){return sessionStorage.getItem(t)}}class v{constructor(){this.local_Storage=new m,this.modelCart=this.local_Storage.getItem(d.CART)||[]}setCartLocalStorage(t){this.local_Storage.setItem(d.CART,t)}returnCopyLocalStorage(){return this.local_Storage.getItem(d.CART)}mergeCart(t,e){const s=t.concat(e.filter(a=>!t.some(i=>i.id===a.id)));s.forEach(a=>{const i=e.find(n=>n.id===a.id);if(i){const n=a.quantity+i.quantity;a.quantity=n<=10?n:10}});const r=s.filter(a=>a!==void 0);return console.log("new merged ",r),s}}class ct{async insertTemplate(t){const e=document.querySelector("#home");return e.innerHTML=t,console.log(e),e}}class O{constructor(t){this.heartsDom=t,this.modelCard="",this.modelIndividualCard="",this.products=""}uI_Individual_Card(t){console.log(t);let e="";this.modelIndividualCard="";const s=this.heartsDom.style.color;console.log(s),Number(this.heartsDom.dataset.id),t.id;const r=document.querySelector("#individual_product");return r.innerHTML="",e=`
            <article class="content_image___individual_item ">
                <img src="${t.image}" alt="image${t.title}" class="image_style">
            </article>

            <aside>            
                <div class="content_title___individual_item">
                    <h1> ${t.title.slice(0,20)}</h1>
                </div>
                <div class='content-button-favorite' data-id="${t.id}">
                    <button type="button" class="favorite individual-favorite" data-id="${t.id}" value="on"> 
                        <svg data-id="${t.id}" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill=${s} class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path data-id="${t.id}" class="pathHeart heart-path" fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                        </svg>
                    </button>
                </div>
                <div class="content-buttons___individual_item">
                    <button type="button" data-id ="${t.id}" class="btn btn-primary btn-card individual_btn_add_to_cart">Add Cart</button>
                </div>
                <div class="content_price___individual_item">
                    <h3>${t.price}€</h3>
                </div>
                <div class="content_description___individual_item">
                    <p>
                        ${t.description.slice(0,40)}
                    </p>
                </div>
            </aside>
        `,this.modelIndividualCard=e,this.modelIndividualCard}insertIndividualCard(){document.querySelector("#individual_product").insertAdjacentHTML("afterbegin",this.modelIndividualCard)}changeColorHeart(){document.querySelector("#individual_product").addEventListener("click",e=>{if(e.target.closest(".individual-favorite")){const r=e.currentTarget.querySelector(".individual-favorite > svg");r.getAttribute("fill")==="black"?(console.log("black"),r.setAttribute("fill","red")):(console.log("red"),r.setAttribute("fill","black"))}})}createPurchasesView(t){const e=document.querySelector("#content_purchases");e.innerHTML="",t.forEach(s=>{const r=document.createElement("div");r.classList.add("purchase"),r.innerHTML=`
                <h3>${s.title}</h3>
                <p>${s.description}</p>
                <p>${s.price}</p>
            `,e.appendChild(r)})}}class j{constructor(t){this.favorites=t,this.id="",this.fav_DOM=""}createFavoriteListUI(t){console.log(t);const e=document.querySelector("#favorites_section");return products_Instance.create_Card(t),e.innerHTML=products_Instance.modelCard,this.favorites=t,this.favorites}display_FavoritesHeart(t){const s="."+document.querySelector(".main-grid").firstElementChild.classList[0],a=[...document.querySelectorAll(s)].map(n=>(n.firstElementChild.firstElementChild.style.color="black",t.find(l=>l.id===Number(n.firstElementChild.dataset.id))?n:null));this.fav_DOM=a.filter(n=>n!==null),this.fav_DOM.map(n=>n.children[0].firstElementChild).forEach(n=>{t===void 0?n.style.color:(()=>{n.style.color==="black"?n.style.color="red":n.style.color="black"})()});const i=new O;return i.heartsDom=this.fav_DOM,this.fav_DOM}}class lt{constructor(t){this.dataUser=t}displayProfilePhoto(t){const e=document.querySelector("#content-img-profile");e.innerHTML="";const s=document.createElement("IMG"),r=document.createElement("A");s.src=t,s.alt="avatar image",s.className="img-user",r.className="link-to-user-menu",r.appendChild(s),e.appendChild(r)}displayUserName(){return this.dataUser.displayName}displayUserEmail(){return this.dataUser.email}}class dt{handler_Display_(t){if(t==="categories")return document.querySelector("#home").style.display="none",document.querySelector(".cart_style").style.display="none",document.querySelector("#content_card").style.display="grid",document.querySelector("#favorites_section").style.display="none",document.querySelector("#individual_product").style.display="none",document.querySelector("#content").style.display="grid";if(t==="home")return document.querySelector("#home").style.display="grid",document.querySelector(".cart_style").style.display="none",document.querySelector("#content_card").style.display="grid",document.querySelector("#favorites_section").style.display="none",document.querySelector("#individual_product").style.display="none",document.querySelector("#content").style.display="grid";if(t==="cart")return document.querySelector(".cart_style").style.display="grid",document.querySelector("#home").style.display="none",document.querySelector("#content_card").style.display="none",document.querySelector("#section_cart").style.display="flex",document.querySelector("#content").style.display="none",document.querySelector("#individual_product").style.display="none";if(t==="favorites")return document.querySelector("#content_card").style.display="none",document.querySelector(".cart_style").style.display="none",document.querySelector("#home").style.display="none",document.querySelector("#content_card").style.display="none",document.querySelector("#favorites_section").style.display="grid",document.querySelector("#individual_product").style.display="none",document.querySelector("#content").style.display="grid";if(t==="individual_product")return document.querySelector("#individual_product").style.display="grid",document.querySelector("#content_card").style.display="none",document.querySelector(".cart_style").style.display="none",document.querySelector("#home").style.display="none",document.querySelector("#favorites_section").style.display="none"}}const P=(o,t=!1)=>{if(console.log(o),console.log(o),t===!0){const r=`<img src="./icon/trash_basket.svg" alt="trash" class='trash_count' data-id=${o.dataset.id}>`;return o.innerHTML=r}else return o.innerHTML="-"},ut=o=>{if(cart===null)return;const t=document.querySelector("#content_total");(()=>{t&&t.remove();const s=document.querySelector("#view_section_cart"),r=`
        
            <aside id="content_total" class="content_total">
                <h3 class="total">Subtotal ${parseFloat(o.total.toFixed(2))}€</h3>
                <a href="#home" class="btn_confirm_buy quantity"  id="pay_confirm">
                    Pagar pedido (${o.quantity} productos)
                </a>
            </aside>
        
        
        `;if(s)return s.insertAdjacentHTML("afterbegin",r)})()};typeof localStorage<"u"&&new O().changeColorHeart();const G={apiKey:"AIzaSyB6C0ZD9j_WGUd0Wwrygb0EOKaYB7T6JME",authDomain:"fakecommerce-2022.firebaseapp.com",projectId:"fakecommerce-2022",storageBucket:"fakecommerce-2022.appspot.com",messagingSenderId:"568390621800",appId:"1:568390621800:web:061d04c4c3ca57fab579dd"},ht=Q(G),F=X(ht);class k{constructor(){this.uid=""}persistanceOfDataUserPictureAtSessionStorage(){const t=new m,e=t.getItem(d.UID),s=t.getItem(d.PICTURE),r=t.getItem(d.NAME),a=t.getItem(d.EMAIL);return{uid:e,picture:s,name:r,email:a}}async loginWithGmail(){try{await tt(F,et);const t=new st;return(await rt(F,t)).user}catch(t){const e=t.code,s=t.message;console.error("Error de inicio de sesión con Google:",e,s)}}async logoutWithGmail(){try{const t=await nt(F);if(F.currentUser)return console.log("user disconnected: ",t),!1;console.log("user disconnected: ",t)}catch(t){const e=t.code,s=t.message;console.error("Error al cerrar sesión",e,s)}}}Q(G);class A{constructor(){this.idPurchase="",this.purchase="",this.newUid=new m,this.realTimeFavorites="",this.cart=""}async saveDataPurchase(t){try{const e=await this.newUid.getItem(g.UID),s=f(),r=Z(w(s,`user/ ${e}/PURCHASES/`)),a=r.key;await H(r,{purchase:t});const n=(await q(r)).val();return this.idPurchase=a,this.purchase=n,this.uid=e,[{id:this.uid,purchase:this.purchase,idPurchase:this.idPurchase}]}catch(e){console.error("Error al guardar datos:",e)}}async returnPurchaseRealTimeDb(){try{const t=await this.newUid.getItem(g.UID),e=f(),s=w(e,`user/ ${t}/PURCHASES/`),r=await q(s);if(r.exists()){const a=r.val();return this.purchase=a,this.purchase}else console.log("no hay")}catch(t){throw console.log("error: ",t),t}}async saveFavoritesRealTimeDb(t){try{const e=await this.newUid.getItem(g.UID),s=f(),r=w(s,`user/ ${e}/FAVORITES/`);await H(r,t),console.log("Datos de favorito guardados con éxito.")}catch(e){console.error("Error al guardar datos de favorito:",e)}}async returnFavoritesRealTimeDb(){try{const t=await this.newUid.getItem(g.UID);console.log(t);const e=f(),s=w(e,`user/ ${t}/FAVORITES/`),r=await q(s);if(r.exists()){const a=r.val();return this.realTimeFavorites=a,console.log(" favorites realtime ",a),this.realTimeFavorites}else console.log("no hay")}catch(t){throw console.log("error: ",t),t}}async saveCart(t){try{const e=await this.newUid.getItem(g.UID),s=f(),r=w(s,`user/ ${e}/CART/`);await H(r,t),console.log("Datos de carrito guardados con éxito.")}catch{console.error("Error al guardar datos")}}async returnCartRealTimeDb(){try{const t=await this.newUid.getItem(g.UID),e=f(),s=await w(e,`user/ ${t}/CART/`),r=await q(s);if(r.exists()){const a=await r.val();return this.realTimeCart=a,console.log("cart realitime: ",this.realTimeCart),this.realTimeCart}}catch{console.error("Error al guardar datos")}}}class D{constructor(){this.favorites=[],this.storageService=new m,this.favorites=this.storageService.getItem(d.FAVORITES)||[]}save_And_Update_Favorites(t){const e=this.favorites.findIndex(s=>s.id===t.id);return e!==-1?(this.favorites.splice(e,1),this.storageService.setItem(d.FAVORITES,this.favorites),this.favorites):(this.favorites.push(t),this.storageService.setItem(d.FAVORITES,this.favorites),this.favorites)}mergeFavorites(t,e){const s={},r=i=>{i&&i.forEach(n=>{const c=n.id;s[c]={...n}})};r(t),r(Object.values(e));const a=Object.values(s);return this.favorites=a,a}}class C{constructor(t){this.heartsDom=t,this.modelCard="",this.modelIndividualCard="",this.products=""}create_Card(t){this.products="",this.modelCard="",this.products=t;let e="";this.products.forEach(s=>(e+=`
                <div class=" content-sale__child shadow-sm p-3 mb-5 bg-body-tertiary rounded" data-category="${s.category}" data-id="${s.id}">
                    <button  type="button" class="favorite" id=${s.id} data-id="${s.id}" value = "on"> 
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path class= "pathHeart" fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                            </svg>
                    </button>
                    <div class="content_photo">
                        <img src="${s.image}" class="${s.title} img-cards-product" alt="" srcset="">
                    </div>
                <div class="content-text">
                    <a href="#individual_product" class="content_names view_one_element individual_product" data-id="${s.id}">
                        ${s.title.slice(0,20)}
                    </a>                      
                    <h4 class= price> ${s.price.toLocaleString("es-AR",{style:"currency",currency:"EUR"})}</h4>  
                </div>
                <button class='btn_add_to_cart' id='${s.id}'>
                Add Cart 
                </button>
                </div>
                `,this.modelCard=e,this.modelCard))}insertAllProducts(){const t=document.querySelector("#content_card");t&&(t.innerHTML=this.modelCard)}}class V extends C{constructor(t){super(t),this.heartsDom=t,this.modelCard="",this.modelIndividualCard="",this.products=""}insertFavorites(){const t=document.querySelector("#favorites_section");t&&(t.innerHTML=this.modelCard)}deleteCardFavorite(){document.querySelector("#favorites_section").addEventListener("click",e=>{e.target.nodeName==="path"&&e.target.parentElement.parentElement.parentElement.remove()})}display_FavoritesHeart(t){const s="."+document.querySelector(".main-grid").firstElementChild.classList[0],a=[...document.querySelectorAll(s)].map(n=>(n.firstElementChild.firstElementChild.style.color="black",t.find(l=>l.id===Number(n.firstElementChild.dataset.id))?n:null));this.fav_DOM=a.filter(n=>n!==null),this.fav_DOM.map(n=>n.children[0].firstElementChild).forEach(n=>{t===void 0?n.style.color:(()=>{n.style.color==="black"?n.style.color="red":n.style.color="black"})()});const i=new C;return i.heartsDom=this.fav_DOM,this.fav_DOM}}class mt{display_FavoritesHeart(t){const s="."+document.querySelector(".main-grid").firstElementChild.classList[0],a=[...document.querySelectorAll(s)].map(n=>(n.firstElementChild.firstElementChild.style.color="black",t.find(l=>l.id===Number(n.firstElementChild.dataset.id))?n:null));this.fav_DOM=a.filter(n=>n!==null),this.fav_DOM.map(n=>n.children[0].firstElementChild).forEach(n=>{t===void 0?n.style.color:(()=>{n.style.color==="black"?n.style.color="red":n.style.color="black"})()});const i=new C;return i.heartsDom=this.fav_DOM,this.fav_DOM}}class y{constructor(){this.objectFav,this.instance_View=new V,this.id="",this.realTimeDb=new A,this.authFirebase=new k,this.favorites=new D,this.changeStateHeart=new mt}handler_Favorites(t){const e=t.target.classList.value;this.id=Number(e==="pathHeart"?t.target.parentElement.parentElement.dataset.id:t.target.dataset.id),this.handlerResponseApi()}async handlerResponseApi(){const t=await this.callingApi();if(u(!1),t===void 0)return u(!0);try{const e=new D;this.favorites=await e.save_And_Update_Favorites(t),this.handlerViewFavorites()}catch(e){console.error(e)}finally{u(!0)}}handlerViewFavorites(){this.changeStateHeart.display_FavoritesHeart(this.favorites)}async callingApi(){u(!1);try{return await S(this.id)}catch(t){return t}finally{u(!0)}}async returnFavoriteRealTimeAuth(t){const e=await this.realTimeDb.returnFavoritesRealTimeDb(t);return this.favorites=e,this.favorites}sendFavoriteToView(){if(this.favorites.favorites.length>0?this.objectFav={list:this.favorites.favorites,validation:!0}:this.objectFav={list:null,validation:!1},this.objectFav.validation===!0){const t=new V;return t.create_Card(this.objectFav.list),t.insertFavorites(),t.display_FavoritesHeart(this.objectFav.list),t.deleteCardFavorite(),this.objectFav}return this.objectFav={list:null,validation:!1},this.objectFav}}class B{constructor(){this.id="",this.delegationContent=document.querySelector("#individual_product"),this.favorite=new y,this.handlerSaveFavorites=new D,this.controllerCart=new I}async handlerSingleProduct(t){u(!1);try{const e=Number(t);return await S(e)}catch{}finally{u(!0)}}listenerAddCart(){this.delegationContent.addEventListener("click",async t=>{const e=t.target.classList.contains("individual_btn_add_to_cart");return this.id=t.target.dataset.id,e===!0?await this.controllerCart.send_Id_To_Api(this.id):void 0})}listenerFavorite(){this.delegationContent.addEventListener("click",async t=>{try{u(!1);const e=t.target.classList.contains("pathHeart"),s=(t.target.classList.value==="pathHeart",t.target.dataset.id);this.id=s;const r=await S(this.id);if(this.id===void 0)return this.id;if(e===!0){const a=await S(this.id);return this.handlerSaveFavorites.save_And_Update_Favorites(a)}}catch(e){console.log(e)}finally{u(!0)}})}}class _t{constructor(){this.timeOut=0}closeSession(){this.timeOut=setTimeout(()=>{console.log("Session closed")},1e4)}stopSession(){clearTimeout(this.timeOut),console.log("Session stopped")}}class W{createCartCont(t){const e=document.querySelector("#count_elements_at_cart"),s=document.querySelector("#section_cart");if(e)return t>9?e.innerText="+9":e.innerText=JSON.stringify(t),s.appendChild(e)}}class Y{constructor(){this.storage=new m,this.model=new v,this.countCartNavBar=new W,this.total=0}addProductsInCart(t){this.shouldClearCart&&(this.model.modelCart=[],this.shouldClearCart=!1);const s=[...this.model.modelCart,t].reduce((i,n)=>{const c=i.findIndex(l=>n.id===l.id);if(c!==-1){const l=this.model.modelCart[c],h=l.quantity+t.quantity>=10?10:l.quantity+t.quantity;if(l.quantity=h,h>=10)return console.log("quantity invalid"),this.model.modelCart}else i.push(n);return i},[]),r=s.some(i=>{const n=this.model.modelCart.find(c=>c.id===i.id);return!n||n.quantity!==i.quantity}),a=s.every(i=>i.quantity===0);return(r||a)&&(this.model.modelCart=s),{result:r||a,cart:this.model.modelCart}}}class M{constructor(){this.total=0,this.quantity,this.storage=new v,this.countCartNavBar=new W}quantity_In_Cart(){return this.quantity=this.storage.returnCopyLocalStorage()===void 0?0:this.storage.returnCopyLocalStorage().reduce((t,e)=>e.quantity===void 0?t:t+e.quantity,0),this.countCartNavBar.createCartCont(this.quantity),this.quantity}controllerCart_Total_Quantity(){const t=this.storage.returnCopyLocalStorage().reduce((e,s)=>(e.quantity=s.quantity+e.quantity,e.total+=s.quantity*s.price,e),{total:0,quantity:0});return this.total=Number(t.total.toFixed(2)),this.quantity_In_Cart(this.storage.returnCopyLocalStorage()),ut(t),this.total}}class gt{constructor(){this.auth=new k,this.user=void 0,this.controllerCart=new Y,this.quantityInCart_And_Total=new M,this.driveCart=new v}async handlerStateStorageConnected(){new y;const t=new D,e=new A,s=new m,r=await this.auth.loginWithGmail();this.user=r,s.setItem(g.UID,this.user.uid);const a=await e.returnFavoritesRealTimeDb();await e.returnPurchaseRealTimeDb();const i=await e.returnCartRealTimeDb(),n=this.driveCart.mergeCart(i,this.driveCart.returnCopyLocalStorage());console.log(n);const c=t.mergeFavorites(a,s.getItem(d.FAVORITES));s.setItem(d.FAVORITES,c),s.setItem(d.CART,n),this.quantityInCart_And_Total.quantity_In_Cart()}async handlerStateStorageDisconnected(){const t=new A,e=new m,s=new b,r=new v,a=new y,i=new C,n=new L,c=new I;await this.auth.logoutWithGmail(),n.reception_Hash("#home"),t.saveCart(e.getItem(d.CART)),t.saveFavoritesRealTimeDb(e.getItem(d.FAVORITES));const l=await s.controller_get_All_Products();i.create_Card(l),i.insertAllProducts(),e.removeItem(d.FAVORITES),e.removeItem(d.CART),a.handler_Favorites(),c.add_Cart_Listener(),this.quantityInCart_And_Total.quantity_In_Cart(e.getItem(d.CART)),r.modelCart=e.getItem(d.CART),console.log("disconnected")}}class yt{constructor(){this.productList=new m}model_UiCart_List=()=>{if(this.productList.getItem(d.CART)===null)return;const t=document.querySelector("#ui_Cart");t.innerHTML="",document.createElement("div"),this.productList.getItem(d.CART).map(e=>{const s=document.createElement("img");s.src="../../public/icon/trash_basket.svg",s.alt="trash basket",s.classList.add("trash_count"),s.setAttribute("data-id",e.id);const r=document.createElement("div");r.classList.add("content_card____cart"),r.setAttribute("data-id",e.id);const a=document.createElement("div");a.classList.add("content_image_product_at_cart","content_photo");const i=document.createElement("img");i.classList.add("img-card____cart"),i.src=e.image,i.alt="img",a.appendChild(i);const n=document.createElement("div");n.classList.add("content_description");const c=document.createElement("h5");c.textContent=e.title.slice(0,20),n.appendChild(c);const l=document.createElement("div");l.classList.add("price");const h=document.createElement("h4");h.textContent=`${e.price}€`,l.appendChild(h);const _=document.createElement("div");_.classList.add("content_select");const E=document.createElement("a");E.classList.add("subtract"),E.setAttribute("data-id",e.id);const p=document.createElement("input");p.classList.add("count","form-control"),p.setAttribute("type","number"),p.setAttribute("min","0"),p.setAttribute("max","10"),p.setAttribute("data-id",e.id),p.value=e.quantity;const T=document.createElement("a");return T.classList.add("add"),T.setAttribute("data-id",e.id),T.textContent="+",_.appendChild(E),_.appendChild(p),_.appendChild(T),r.appendChild(a),r.appendChild(n),r.appendChild(l),r.appendChild(_),t.appendChild(r),e.quantity===1?E.appendChild(s):E.textContent="-",{...e,content_Data:r}})};handle_Delete_Element_In_DOM(t){return t.remove()}}class pt{constructor(){this.model=new v}update_Quantity_Cart(t="",e){if(e===!0){const r=this.model.returnCopyLocalStorage().map(a=>a.id===t?{...a,quantity:a.quantity-1}:a).filter(a=>a.quantity>0);return this.model.setCartLocalStorage(r),this.model.returnCopyLocalStorage(),this.model.modelCart=r}const s=this.model.returnCopyLocalStorage().map(r=>r.id===t?{...r,quantity:r.quantity<=9?r.quantity+1:r.quantity}:r).filter(r=>r.quantity>0);return this.model.setCartLocalStorage(s),this.model.modelCart=s,this.cart}}class z{constructor(){this.model=new v,this.updateQuantity=new pt,this.id=""}subtractProduct(){return this.updateQuantity.update_Quantity_Cart(this.id,!0)}}class vt extends z{addProduct(){this.updateQuantity.update_Quantity_Cart(this.id,!1)}}class U{constructor(){this.events={}}addListener(t,e,s){this.events[t]||(this.events[t]=[]),this.events[t].push({selector:e,callback:s});const r=e.startsWith("#")?[document.getElementById(e.slice(1))]:document.querySelectorAll(e);r.length===1&&r[0]===null||r.forEach(a=>{a.addEventListener(t,s)})}removeListener(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(s=>s!==e))}triggerEvent(t){(this.events[t]||[]).forEach(({querySelector:s,callback:r})=>{document.querySelectorAll(s).forEach(i=>{i.addEventListener(t,r)})})}}class Ct{createDynamicCategoryNav(t){const e=document.querySelector("#list_classification");let s="";t.forEach(r=>{if(s+=`
                        <li class="dropdown-item_ul">
                            <a class="dropdown-item listener_category route" href="#_categories" data-category="${r}"> ${r} </a>
                        </li>
                        `,e)return e.innerHTML=s})}displayProductsByCategory=t=>{const e=document.querySelector("#content_card"),s=new C;s.create_Card(t),e.innerHTML=s.modelCard}}class N{constructor(){this.mainProduct=S(7)}singleProduct(){return this.mainProduct}}const ft=new N;console.log(await ft.mainProduct);class J{constructor(){this.mainProductView=new ct,this.controllerMainProduct=new N,this.product=this.controllerMainProduct.singleProduct(),this.templateHtml=""}async templateMainProduct(){const{image:t}=await this.product,e=`
            <div class=vertical-container>
                <span>N</span>
                <span>E</span>
                <span>W</span>
                <span></span>
                <span>S</span>
                <span>E</span>
                <span>A</span>
                <span>S</span>
                <span>O</span>
                <span>N</span>
            </div>
        <aside aside class="container-main-banner" >
            <div>
            <img src=${t} 
            alt="image main product
            class=main-image" 
            />
            </div>
            <p>
                lorem ipsum dolor sit amet, consectetur adipiscing elit.
            </p>
        </aside >
        `;return this.templateHtml=e,this.templateHtml}}const $=new J;$.mainProductView.insertTemplate(await $.templateMainProduct());const wt=new m,St=new dt;class K{constructor(){this.eventListeners=new U,this.instanceFavorites=new y}addListenerHeartFavorites(){this.eventListeners.addListener("click",".favorite",t=>{this.instanceFavorites.handler_Favorites(t)})}addFavoriteSectionListener(){this.eventListeners.addListener("click","#favorites",t=>{console.log(t),this.instanceFavorites.sendFavoriteToView()})}}class bt{constructor(){this.eventListeners=new U,this.saveRealtime=new A}}class b{constructor(t=[],e,s){this.products=t,this.single_Product,this.categories=e,this.total=s,this.HandlerClickFavorites=new K,this.controllerFavorites=new y,this.favoritesView=new j,this.dynamicCategories=new Ct,this.eventListeners=new U,this.mainProductView=new J,this.controllerMainProduct=new N}async controller_get_All_Products(){u(!1);try{return this.products=await at(),this.products.status>=200&&this.products.status<300,this.products}catch(t){console.log(t)}finally{u(!0)}}homeInit(){this.eventListeners.addListener("click","#_home",async t=>{const e=new b,s=new b,r=new I,a=new C,i=await s.controller_get_All_Products();a.create_Card(i),a.insertAllProducts();const n=new m;this.favoritesView.display_FavoritesHeart(n.getItem(d.FAVORITES)),e.controllerViewIndividualProduct(),r.add_Cart_Listener(),this.HandlerClickFavorites.addListenerHeartFavorites()})}async control_View_Categories(){u(!1);try{return this.categories=await ot(),this.dynamicCategories.createDynamicCategoryNav(this.categories)}catch(t){console.log(t)}finally{u(!0)}}listener_Category(){document.querySelectorAll(".listener_category").forEach(e=>e.addEventListener("click",s=>{this.send_Category(s.target.dataset.category)}))}async send_Category(t=""){u(!1);try{const e=new I,s=new b,r=new y,a=await it(t);this.dynamicCategories.displayProductsByCategory(a),e.add_Cart_Listener(),this.HandlerClickFavorites.addListenerHeartFavorites();const i=a.reduce((n,c)=>(wt.getItem(d.FAVORITES).forEach(l=>{c.category===l.category&&c.category!==void 0&&!n.some(h=>h.id===l.id)&&n.push(l)}),n),[]);r.instance_View.display_FavoritesHeart(i),this.controllerViewIndividualProduct()}catch(e){console.error(e)}finally{u(!0)}}controllerViewIndividualProduct(){document.querySelectorAll(".individual_product").forEach(e=>{e.addEventListener("click",async s=>{const r=s.target.parentElement.parentElement.firstElementChild.firstElementChild,i=await new B().handlerSingleProduct(s.target.dataset.id),n=new O;n.heartsDom=r,n.uI_Individual_Card(i),n.insertIndividualCard()})})}}class I{constructor(t){this.model=new v,this.RealTimeDB=new A,this.renderCards=new yt,this.auth=new k,this.subtract=new z,this.add=new vt,this.storage=new m,this.addProductsInCart=new Y,this.cart="",this.elementDom=t,this.single_Product=null,this.id=null,this.shouldClearCart=!1,this.acu=0,this.total=0,this.eventListeners=new U,this.totalAndQuantity=new M}clearCart(){this.shouldClearCart=!0}async send_Id_To_Api(t){if(u(!1),t)try{const e=await S(t);return this.single_Product=e,{quantity:1,...this.single_Product}}catch(e){console.log(e)}finally{u(!0)}}add_Cart_Listener(){this.eventListeners.addListener("click",".btn_add_to_cart",async t=>{const e=Number(t.target.id),s=await this.send_Id_To_Api(e),r=this.addProductsInCart.addProductsInCart(s);this.model.setCartLocalStorage(r.cart),this.totalAndQuantity.quantity_In_Cart()})}assign_Events_Products(){const t=document.querySelector("#section_cart"),e=document.querySelector("#ui_Cart"),s=()=>e.addEventListener("click",r=>{const a=r.target,i={subtract:n=>{const c=n.getAttribute("data-id"),l=n.nextElementSibling;this.subtract.id=Number(c),this.subtract.subtractProduct();const h=this.model.returnCopyLocalStorage().find(_=>_.id===Number(c)).quantity;l.value=String(h),h===1&&P(n,!0),this.totalAndQuantity.quantity_In_Cart(),this.totalAndQuantity.controllerCart_Total_Quantity()},add:n=>{const c=n.getAttribute("data-id"),l=n.previousElementSibling;this.add.id=Number(c),this.add.addProduct();const h=this.model.returnCopyLocalStorage().find(_=>_.id===Number(c)).quantity;console.log(this.model.returnCopyLocalStorage()),l.value=String(h),h===2&&P(n.previousElementSibling.previousElementSibling,!1),console.log(h===10?"quantity no validate value":!0),this.totalAndQuantity.quantity_In_Cart(),this.totalAndQuantity.controllerCart_Total_Quantity()},trash_count:n=>{const c=n.getAttribute("data-id");this.subtract.id=Number(c),this.subtract.subtractProduct(),this.renderCards.handle_Delete_Element_In_DOM(r.target.parentElement.parentElement.parentElement);const l=new L;this.totalAndQuantity.quantity_In_Cart(),this.totalAndQuantity.controllerCart_Total_Quantity(),this.model.returnCopyLocalStorage().length===0&&l.reception_Hash("#home")}};for(const n of a.classList)if(n in i){i[n](a);break}});t.addEventListener("click",s())}sendListCartToView(){this.eventListeners.addListener("click","#section_cart",()=>{this.renderCards.model_UiCart_List(),this.totalAndQuantity.controllerCart_Total_Quantity(),new bt().addEventListenerPurchase()})}dynamic_Change_Symbols(){const t=document.querySelectorAll(".add");document.querySelectorAll(".subtract").forEach(s=>{s.addEventListener("click",r=>{if(r.target.nextElementSibling===null){const a=r.target.parentElement.parentElement.parentElement;return Number(r.target.dataset.id),console.log(this.acu),this.renderCards.handle_Delete_Element_In_DOM(a)}this.subtract.id=Number(r.target.nextElementSibling.dataset.id),this.acu=Number(r.target.nextElementSibling.value),this.acu===1&&(console.log(this.acu),this.elementDom=s,P(this.elementDom,!0)),console.log(this.acu),r.target.nextElementSibling.value=String(this.acu)})}),t.forEach(s=>{s.addEventListener("click",r=>{Number(r.target.previousElementSibling.dataset.id),this.acu===2&&(this.elementDom=r.target.previousElementSibling.previousElementSibling,console.log(this.acu),P(this.elementDom,!1)),console.log(this.acu),this.acu===10&&(console.log(this.acu),r.target.previousElementSibling.disabled=!0),r.target.previousElementSibling.value=String(this.acu)})})}}class x{constructor(t){this.uid="",this.favoritesController=new y,this.auth=new gt,this.viewUser=new lt,this.total_quantity=new M,this.addEventCartProduct=new I}async loginUser(){const t=(s="./icon/user.png")=>{if(this.viewUser.displayProfilePhoto(s),this.auth.user)return this.viewUser.displayProfilePhoto(s)};t(),document.querySelector("#google-sign-in-btn").addEventListener("click",async s=>{const r=new m;s.preventDefault();try{if(this.auth.user!=null)return this.auth.handlerStateStorageDisconnected(),this.auth.user=null,t(),new L().reception_Hash("#home"),console.log("disconnected"),this.auth.user;const a=new j;await this.auth.handlerStateStorageConnected(),t(this.auth.user.photoURL);const i=r.getItem(d.CART),n=r.getItem(d.FAVORITES);a.display_FavoritesHeart(n),this.total_quantity.quantity_In_Cart(i)}catch(a){console.log("error",a)}finally{this.uid=r.getSessionStorageUid(g.UID)||"",this.auth.user?s.target.textContent="Logout":s.target.textContent="Login",s.target.dataset.userState=this.auth.user?"connect":"disconnect"}})}}class L{reception_Hash=(t="")=>{const e={"#individual_product":"individual_product","#home":"home","#view_section_cart":"cart","#_categories":"categories","#favorites_section":"favorites"};return St.handler_Display_(e[t])}}if(typeof localStorage<"u"){new L().reception_Hash("#home"),new x().loginUser();const e=new I,s=new m;new x;const r=new y,a=new C,i=new B,n=new K,c=new b;e.sendListCartToView();const l=await c.controller_get_All_Products();a.create_Card(l),a.insertAllProducts(),c.homeInit(),await c.control_View_Categories(),e.add_Cart_Listener(),e.assign_Events_Products(),c.controllerViewIndividualProduct(),c.listener_Category(),s.getItem(d.FAVORITES).length!==0?console.log("lleno"):console.log("vacio"),i.listenerAddCart(),i.listenerFavorite(),r.sendFavoriteToView(),n.addListenerHeartFavorites(),n.addFavoriteSectionListener()}const It=new _t;It.closeSession();window.addEventListener("hashchange",o=>{console.log(o);const t=new L;console.log(o.oldURL),t.reception_Hash(location.hash),console.log(location.hash)},!1);window.addEventListener("load",o=>{console.log(o),window.home.addEventListener("click",t=>new_Routes.push_Id(t)),window._categories.addEventListener("click",t=>new_Routes.push_Id(t)),window["#individual_product"].addEventListener("click",t=>new_Routes.push_Id(t)),window.cart.addEventListener("click",t=>new_Routes.push_Id(t)),window.pay.addEventListener("click",t=>new_Routes.push_Id(t))});
